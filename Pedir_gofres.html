<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Construye tu MontaÃ±a de Gofres ðŸ§‡</title>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            background: #fcefe6;
            text-align: center;
            padding: 30px;
            color: #333;
        }

        h1 {
            color: #d2691e;
        }

        .tower {
            display: flex;
            flex-direction: column-reverse;
            align-items: center;
            margin: 20px auto;
            width: 200px;
            height: 270px;
            border: 4px dashed #ccc;
            border-radius: 10px;
            padding: 10px;
            background-color: #fff8f0;
        }

        .layer {
            width: 180px;
            height: 60px;
            margin: 5px 0;
            border-radius: 10px;
            line-height: 60px;
            color: rgb(0, 0, 0);
            font-weight: bold;
            font-size: 14px;
            background-color: #ddd;
            transition: all 0.3s ease;
        }

        .controls {
            margin-top: 20px;
        }

        .ingredient {
            padding: 10px 15px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
        }

        .gofre { background-color: #d2691e; }
        .choco-blanco { background-color: #fffacd; color: #333; }
        .choco-leche { background-color: #4b2e2e; }
        .choco { background-color: #6a3313; }
        .kitkat { background-color: #8b0000; }

        .submit-btn {
            margin-top: 25px;
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            font-weight: bold;
            border-radius: 5px;
            cursor: pointer;
        }

        .submit-btn:hover {
            background-color: #45a049;
        }

        @media screen and (max-width: 600px) {
            h1 {
                font-size: 2em;
            }

            .tower {
                width: 90%;
                padding: 10px;
            }

            .ingredient {
                font-size: 1em;
                min-width: 100px;
            }

            .submit-btn {
                font-size: 1.1em;
                padding: 10px 20px;
            }
        }
    </style>
</head>
<body>
    <h1>Construye tu MontaÃ±a de Gofres ðŸ§‡</h1>

    <div class="tower" id="tower">
        <!-- Las capas se insertarÃ¡n aquÃ­ -->
    </div>

    <div class="controls">
        <button class="ingredient gofre" onclick="addLayer('Gofre')">Gofre</button>
        <button class="ingredient choco-blanco" onclick="addLayer('Nocilla Blanca')">Nocilla Blanca</button>
        <button class="ingredient choco-leche" onclick="addLayer('Nocilla Normal')">Nocilla Normal</button>
        <button class="ingredient choco" onclick="addLayer('Chocogofre')">Chocogofre</button>
        <button class="ingredient kitkat" onclick="addLayer('KitKat')">KitKat</button>
        <button class="ingredient" onclick="removeLayer()" style="background:#ff4444;color:white;">Eliminar capa</button>
    </div>

    <button class="submit-btn" onclick="submitStack()">ðŸ¥ž Enviar montaÃ±a de tortitas ðŸ¥ž</button>

    <script>
const tower = document.getElementById('tower');
let stack = [];

// Mapa de ingredientes a colores
const ingredientColors = {
    'Gofre': '#d2691e', // Color de tortita
    'Nocilla Blanca': '#fffacd', // Color de chocolate blanco
    'Nocilla Normal': '#4b2e2e', // Color de chocolate negro
    'Chocogofre': '#6a3313' , // Color de KitKat
    'KitKat': '#8b0000' // Color de KitKat
};


// FunciÃ³n para crear una capa visual
function createLayer(name) {
    const div = document.createElement('div');
    div.classList.add('layer');
    div.textContent = name;

    // Asignar color segÃºn el ingrediente
    div.style.backgroundColor = ingredientColors[name] || '#f0f0f0'; // Color predeterminado si no estÃ¡ en el mapa

    // Si el ingrediente es "Chocolate Blanco", poner el texto de color gris
    if (name === 'Chocolate Blanco') {
        div.style.color = '#808080'; // Color gris para el texto
    }

    return div;
}

// FunciÃ³n para agregar una capa
function addLayer(name) {
    // Contar cuÃ¡ntos "Gofres" hay en el stack
    const gofresCount = stack.filter(item => item === 'Gofre').length;

    // Validar que no se agreguen mÃ¡s de 3 gofres
    if (name === 'Gofre' && gofresCount >= 1) {
        alert('Â¡No puedes agregar mÃ¡s de 1 gofre!');
        return;
    }

    // Validar que no se agreguen mÃ¡s de 5 capas en total
    if (stack.length >= 3) {
        alert('Â¡No puedes agregar mÃ¡s de 3 capas en total!');
        return;
    }

    // Crear la capa y agregarla al stack y la torre
    const layer = createLayer(name);
    stack.push(name);
    tower.appendChild(layer);
}

// FunciÃ³n para eliminar la Ãºltima capa
function removeLayer() {
    if (stack.length > 0) {
        stack.pop();
        tower.removeChild(tower.lastChild);
    }
}

// FunciÃ³n para enviar la montaÃ±a al servidor
function submitStack() {
    // Verificar que haya al menos un "Gofre"
    const gofresCount = stack.filter(item => item === 'Gofre').length;
    if (gofresCount === 0) {
        alert('Â¡Debe haber al menos un gofre!');
        return;
    }

    if (stack.length === 0) {
        alert('Â¡Agrega al menos una capa!');
        return;
    }

    const mesa = prompt("Â¿Nombre?");
    if (!mesa) {
        alert('Debes ingresar un nombre.');
        return;
    }

    // Convertir el stack a un string Ãºnico
    const descripcion = stack.join(' > ');

    fetch('http://localhost:3000/api/orders', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            table: mesa,
            product: [descripcion]  // un solo producto con todo dentro
        })
    })
    .then(res => {
        if (res.ok) {
            alert('Â¡MontaÃ±a enviada con Ã©xito! ðŸ§‡');
            stack = [];
            tower.innerHTML = ''; // Limpiar la torre despuÃ©s de enviar
        } else {
            alert('Error al enviar la montaÃ±a ðŸ˜¢');
        }
    })
    .catch(err => {
        console.error(err);
        alert('Error de conexiÃ³n');
    });
}
    </script>
</body>
</html>
